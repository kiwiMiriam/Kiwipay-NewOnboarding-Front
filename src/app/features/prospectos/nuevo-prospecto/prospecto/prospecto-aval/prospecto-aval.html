<!-- INFORMACIÓN AVALISTA (Sección expandible - opcional) -->
<div class="section-container">
  <form [formGroup]="clientForm" (ngSubmit)="onSubmit($event)">
    <div class="expandable-section">
      <div class="section-toggle" (click)="toggleAvalista()">
        <div class="section-header">
          <h4>Información del Aval</h4>
        </div>
        <span class="toggle-icon">{{ isAvalistaExpanded ? '▼' : '►' }}</span>
      </div>

      @if (isAvalistaExpanded) {
      <div class="expanded-content" formGroupName="avalista">
        <div class="form-row">
          <div class="form-group">
            <label for="avalistaTipoDocumento">Tipo de Documento</label>
            <select id="avalistaTipoDocumento" formControlName="tipoDocumento">
              <option value="">Seleccione...</option>
              <option value="DNI">DNI</option>
              <option value="CE">Carnet de Extranjería</option>
              <option value="PASAPORTE">Pasaporte</option>
            </select>
          </div>

          <div class="form-group">
            <label for="avalistaNumeroDocumento">Número de Documento</label>
            <input type="text" id="avalistaNumeroDocumento" formControlName="numeroDocumento" />
          </div>
          <div class="form-group">
            <label for="avalistaIngresos">Ingresos (S/)</label>
            <input type="number" id="avalistaIngresos" formControlName="ingresos" min="0" step="100" />
            <div class="error-message" *ngIf="submitted && f['ingresos'].errors">
              <span *ngIf="f['ingresos'].errors['required']">El ingreso es requerido</span>
              <span *ngIf="f['ingresos'].errors['min']">El ingreso debe ser mayor a 0</span>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="avalistaNombres">Nombres</label>
            <input type="text" id="avalistaNombres" formControlName="nombres" />
          </div>

          <div class="form-group">
            <label for="avalistaApellidos">Apellidos</label>
            <input type="text" id="avalistaApellidos" formControlName="apellidos" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="avalistaSexo">Sexo</label>
            <select id="avalistaSexo" formControlName="sexo">
              <option value="">Seleccione...</option>
              <option value="M">Masculino</option>
              <option value="F">Femenino</option>
              <option value="O">Otro</option>
            </select>
          </div>

          <div class="form-group">
            <label for="avalistaTelefono">Teléfono</label>
            <input type="tel" id="avalistaTelefono" formControlName="telefono" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="avalistaEstadoCivil">Estado Civil *</label>
            <select id="avalistaEstadoCivil" formControlName="estadoCivil">
              <option value="">Seleccione...</option>
              <option value="SOLTERO">Soltero(a)</option>
              <option value="CASADO">Casado(a)</option>
              <option value="DIVORCIADO">Divorciado(a)</option>
              <option value="VIUDO">Viudo(a)</option>
              <option value="CONVIVIENTE">Conviviente</option>
            </select>
          </div>
          <div class="form-group">
            <label for="avalistaCorreo">Correo Electrónico</label>
            <input type="email" id="avalistaCorreo" formControlName="correo" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="avalistaDepartamento">Departamento</label>
            <select
              id="avalistaDepartamento"
              formControlName="departamento"
              (change)="onAvalistaDepartamentoChange()"
            >
              <option value="">Seleccione...</option>
              @for (dep of departamentos; track dep.id) {
              <option [value]="dep.nombre">{{ dep.nombre }}</option>
              }
            </select>
          </div>

          <div class="form-group">
            <label for="avalistaProvincia">Provincia</label>
            <select
              id="avalistaProvincia"
              formControlName="provincia"
              (change)="onAvalistaProvinciaChange()"
            >
              <option value="">Seleccione...</option>
              @for (prov of avalistaProvincias; track prov.id) {
              <option [value]="prov.nombre">{{ prov.nombre }}</option>
              }
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="avalistaDistrito">Distrito</label>
            <select id="avalistaDistrito" formControlName="distrito">
              <option value="">Seleccione...</option>
              @for (dist of avalistaDistritos; track dist.id) {
              <option [value]="dist.nombre">{{ dist.nombre }}</option>
              }
            </select>
          </div>

          <div class="form-group full-width">
            <label for="avalistaDireccion">Dirección</label>
            <input type="text" id="avalistaDireccion" formControlName="direccion" />
          </div>
        </div>
        <div class="form-buttons">
          <button type="submit" class="btn-primary" [disabled]="isLoading">
            @if (isLoading) { Guardando... } @else { @if (editMode) { Actualizar } @else { Registrar } }
          </button>
        </div>
      </div>
      }
    </div>
  </form>

  @if (isAvalistaExpanded) {
    <div class="documentos-section">
      <h2>Documentos del Aval</h2>
      <app-document-table
        [documentos]="documentosList"
        (subir)="onDocumentoSubir($event)"
        (descargar)="onDocumentoDescargar($event)"
        (aprobar)="onDocumentoAprobar($event)"
        (rechazar)="onDocumentoRechazar($event)">
      </app-document-table>
    </div>
  }
</div>
