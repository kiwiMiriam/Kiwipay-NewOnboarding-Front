<div class="section-container">
  <form [formGroup]="clientForm" (ngSubmit)="onSubmit()">
    <!-- INFORMACIÓN TITULAR -->
    <div class="expandable-section">
      <div class="section-toggle" (click)="toggleTitular()">
        <div class="section-header">
          <h4>Información del Titular</h4>
          <span class="toggle-icon">{{ isTitularExpanded ? '▼' : '►' }}</span>
        </div>
      </div>

      @if( isTitularExpanded) {
      <div class="expanded-content">
        <div class="form-row">
          <div class="form-group">
            <label for="tipoDocumento">Tipo de Documento *</label>
            <select id="tipoDocumento" formControlName="tipoDocumento">
              <option value="">Seleccione...</option>
              <option value="DNI">DNI</option>
              <option value="CE">Carnet de Extranjería</option>
              <option value="PASAPORTE">Pasaporte</option>
            </select>
            @if (submitted && f['tipoDocumento'].errors) {
            <div class="error-message">El tipo de documento es requerido</div>
            }
          </div>

          <div class="form-group">
            <label for="numeroDocumento">Número de Documento *</label>
            <input type="text" id="numeroDocumento" formControlName="numeroDocumento" />
            @if (submitted && f['numeroDocumento'].errors) {
            <div class="error-message">
              @if (f['numeroDocumento'].errors['required']) { El número de documento es requerido }
              @else if (f['numeroDocumento'].errors['pattern']) { El formato del documento no es
              válido }
            </div>
            }
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="nombres">Nombres *</label>
            <input type="text" id="nombres" formControlName="nombres" />
            @if (submitted && f['nombres'].errors) {
            <div class="error-message">Este campo es requerido</div>
            }
          </div>

          <div class="form-group">
            <label for="apellidos">Apellidos *</label>
            <input type="text" id="apellidos" formControlName="apellidos" />
            @if (submitted && f['apellidos'].errors) {
            <div class="error-message">Este campo es requerido</div>
            }
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="estadoCivil">Estado Civil *</label>
            <select id="estadoCivil" formControlName="estadoCivil">
              <option value="">Seleccione...</option>
              <option value="SINGLE">Soltero(a)</option>
              <option value="MARRIED">Casado(a)</option>
              <option value="DIVORCED">Divorciado(a)</option>
              <option value="WIDOWED">Viudo(a)</option>
              <option value="COHABITANT">Conviviente</option>
            </select>
            @if (submitted && f['estadoCivil'].errors) {
            <div class="error-message">Este campo es requerido</div>
            }
          </div>

          <div class="form-group">
            <label for="fechaNacimiento">Fecha de Nacimiento *</label>
            <input type="date" id="fechaNacimiento" formControlName="fechaNacimiento" />
            @if (submitted && f['fechaNacimiento'].errors) {
            <div class="error-message">Este campo es requerido</div>
            }
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="sexo">Sexo *</label>
            <select id="sexo" formControlName="sexo">
              <option value="">Seleccione...</option>
              <option value="M">Masculino</option>
              <option value="F">Femenino</option>
            </select>
            @if (submitted && f['sexo'].errors) {
            <div class="error-message">Este campo es requerido</div>
            }
          </div>

          <div class="form-group">
            <label for="correo">Correo Electrónico *</label>
            <input type="email" id="correo" formControlName="correo" />
            @if (submitted && f['correo'].errors) {
            <div class="error-message">
              @if (f['correo'].errors['required']) { El correo es requerido } @else if
              (f['correo'].errors['email']) { El formato del correo no es válido }
            </div>
            }
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="telefono">Teléfono *</label>
            <input type="tel" id="telefono" formControlName="telefono" />
            @if (submitted && f['telefono'].errors) {
            <div class="error-message">Este campo es requerido</div>
            }
          </div>
          <div class="form-group">
            <label for="telefono">Teléfono 2 (Opcional)</label>
            <input type="tel" id="telefono2" formControlName="telefono2" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="departamento">Departamento *</label>
            <select id="departamento" formControlName="departamento" (change)="onDepartamentoChange()">
              <option value="">Seleccione...</option>
              @for (dep of departamentos; track dep.id) {
              <option [value]="dep.id">{{ dep.name }}</option>
              }
            </select>
            @if (submitted && f['departamento'].errors) {
            <div class="error-message">Este campo es requerido</div>
            }
          </div>

          <div class="form-group">
            <label for="provincia">Provincia *</label>
            <select id="provincia" formControlName="provincia" (change)="onProvinciaChange()">
              <option value="">Seleccione...</option>
              @for (prov of provincias; track prov.id) {
              <option [value]="prov.id">{{ prov.name }}</option>
              }
            </select>
            @if (submitted && f['provincia'].errors) {
            <div class="error-message">Este campo es requerido</div>
            }
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="distrito">Distrito *</label>
            <select id="distrito" formControlName="distrito">
              <option value="">Seleccione...</option>
              @for (dist of distritos; track dist.id) {
              <option [value]="dist.id">{{ dist.name }}</option>
              }
            </select>
            @if (submitted && f['distrito'].errors) {
            <div class="error-message">Este campo es requerido</div>
            }
          </div>

          <div class="form-group full-width">
            <label for="direccion">Dirección *</label>
            <input type="text" id="direccion" formControlName="direccion" />
            @if (submitted && f['direccion'].errors) {
            <div class="error-message">Este campo es requerido</div>
            }
          </div>
        </div>
      </div>
      <div class="form-buttons">
        <button type="submit" class="btn-primary" [disabled]="isLoading">
          @if (isLoading) { Guardando... } @else { @if (editMode) { Actualizar } @else { Registrar } }
        </button>
      </div>
      }
    </div>
  </form>
</div>