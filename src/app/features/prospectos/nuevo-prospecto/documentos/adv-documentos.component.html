<div class="adv-documentos-container">
  <h2 class="section-title">ADV - Revisión de Documentos</h2>
  <p class="section-description">
    Aprueba o rechaza los documentos del prospecto. Puedes agregar comentarios durante la revisión.
  </p>

  <!-- Estado del Cliente y Botones de ADV -->
  @if (clientStatus) {
    <div class="client-status-section">
      <h3>Estado del Cliente: <span class="status-text">{{ getStatusDisplayText() }}</span></h3>
      
      <!-- Botones de ADV -->
      <div class="adv-actions">
        <button 
          class="btn-primary" 
          (click)="aprobarPorADV()"
          [disabled]="!isAdvActionsEnabled() || isExecutingAction">
          {{ isExecutingAction ? 'Procesando...' : 'Aprobar por ADV' }}
        </button>
        
        <button 
          class="btn-warning" 
          (click)="observarPorADV()"
          [disabled]="!isAdvActionsEnabled() || isExecutingAction">
          {{ isExecutingAction ? 'Procesando...' : 'Observar por ADV' }}
        </button>
      </div>
    </div>
  }

  @if (mensajeError) {
    <div class="error-message">
      <span class="icon-warning"></span> {{ mensajeError }}
    </div>
  }

  <!-- Tabla de documentos para revisión -->
  <div class="documentos-table-container">
    <div class="table-header">
      <div class="column tipo-column">Tipo de Documento</div>
      <div class="column archivo-column">Archivo</div>
      <div class="column comentario-column">Comentario</div>
      <div class="column estado-column">Estado</div>
      <div class="column accion-column">Acciones ADV</div>
    </div>
    
    @if (isLoading) {
      <div class="empty-state">
        <p>Cargando documentos...</p>
      </div>
    }
    
    @if (!isLoading && documentos.length === 0) {
      <div class="empty-state">
        <div class="empty-icon"></div>
        <p>No hay documentos para revisar</p>
        <small>Los documentos aparecerán aquí una vez que sean subidos en la sección de Documentos</small>
      </div>
    }

    <div class="table-body">
      @for (documento of documentos; track documento.id) {
        <div class="table-row">
          <div class="column tipo-column">{{ obtenerNombreTipoDocumento(documento.documentTypeId) }}</div>
          <div class="column archivo-column">
            <div class="file-info">
              <span [class]="'icon-file ' + obtenerClaseIconoArchivo(documento.mimeType)"></span>
              <div class="file-details">
                <span class="file-name">{{ documento.filename }}</span>
                <span class="file-size">{{ formatearTamanoArchivo(documento.sizeBytes) }}</span>
              </div>
            </div>
          </div>
          <div class="column comentario-column">
            <span class="comment-text">{{ documento.comment || '-' }}</span>
          </div>
          <div class="column estado-column">
            <span [class]="'status-badge ' + obtenerClaseIconoEstado(documento.reviewStatus)">
              {{ obtenerTextoEstado(documento.reviewStatus) }}
            </span>
          </div>
          <div class="column accion-column">
            <button
              class="btn-icon approve-btn"
              (click)="abrirModalAprobacion(documento)"
              title="Aprobar documento"
              [disabled]="documento.reviewStatus === 'APPROVED'"
            >
              <fa-icon [icon]="faCheck"></fa-icon>
            </button>
            <button
              class="btn-icon reject-btn"
              (click)="abrirModalRechazo(documento)"
              title="Rechazar documento"
              [disabled]="documento.reviewStatus === 'REJECTED'"
            >
              <fa-icon [icon]="faTimes"></fa-icon>
            </button>
          </div>
        </div>
      }
    </div>
  </div>

  <!-- COMPONENTES MOVIDOS DESDE RIESGO -->
  <app-prospecto-titular
    [initialData]="prospectoData?.titular"
    (dataSaved)="onTitularSaved($event)"
    (dataUpdated)="onTitularUpdated($event)">
  </app-prospecto-titular>

  <app-prospecto-paciente
    [clientId]="getClientId()"
    [initialData]="prospectoData?.paciente"
    (dataSaved)="onPacienteSaved($event)"
    (dataUpdated)="onPacienteUpdated($event)">
  </app-prospecto-paciente>

  <app-prospecto-aval
    [clientId]="getClientId()"
    [initialData]="prospectoData?.avalista"
    [documentos]="documentosAsociado"
    (dataSaved)="onAvalistaSaved($event)"
    (dataUpdated)="onAvalistaUpdated($event)">
  </app-prospecto-aval>

  <!-- Formulario del Cónyuge del Titular -->
  <div class="section-container">
    <div class="expandable-section">
      <div class="section-toggle" (click)="toggleConyugeTitularSection()">
        <div class="section-header">
          <h4>Información del Cónyuge del Titular</h4>
        </div>
        <span class="toggle-icon">{{ isConyugeTitularExpanded ? '▼' : '►' }}</span>
      </div>
      
      @if (isConyugeTitularExpanded && conyugeTitularForm) {
        <div class="expanded-content">
          <form [formGroup]="conyugeTitularForm" (ngSubmit)="updateConyugeTitular()">
            <div class="form-row">
              <div class="form-group">
                <label for="conyugeTitularTipoDocumento">Tipo de Documento</label>
                <select id="conyugeTitularTipoDocumento" formControlName="tipoDocumento">
                  <option value="">Seleccione...</option>
                  <option value="DNI">DNI</option>
                  <option value="CE">Carnet de Extranjería</option>
                  <option value="PASAPORTE">Pasaporte</option>
                </select>
              </div>
              <div class="form-group">
                <label for="conyugeTitularNumeroDocumento">Número de Documento</label>
                <input type="text" id="conyugeTitularNumeroDocumento" formControlName="numeroDocumento">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="conyugeTitularNombres">Nombres</label>
                <input type="text" id="conyugeTitularNombres" formControlName="nombres">
              </div>
              <div class="form-group">
                <label for="conyugeTitularApellidos">Apellidos</label>
                <input type="text" id="conyugeTitularApellidos" formControlName="apellidos">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="conyugeTitularCorreo">Correo Electrónico</label>
                <input type="email" id="conyugeTitularCorreo" formControlName="correo">
              </div>
              <div class="form-group">
                <label for="conyugeTitularTelefono">Teléfono</label>
                <input type="tel" id="conyugeTitularTelefono" formControlName="telefono">
              </div>
            </div>
            
            <div class="form-actions">
              <button type="submit" class="btn-primary" [disabled]="isUpdatingConyugeTitular">
                {{ isUpdatingConyugeTitular ? 'Actualizando...' : 'Actualizar Datos' }}
              </button>
              <button type="button" class="btn-secondary" (click)="resetConyugeTitularForm()">
                Cancelar
              </button>
            </div>
          </form>
        </div>
      }
    </div>
  </div>

  <!-- Modal para aprobación/rechazo -->
  @if (mostrarModalAccion && documentoSeleccionado) {
    <app-modal-accion
      [mostrarModal]="mostrarModalAccion"
      [documento]="documentoSeleccionado"
      [accion]="accionSeleccionada"
      (cerrar)="cerrarModalAccion()"
      (confirmar)="confirmarAccion($event)"
    ></app-modal-accion>
  }

  <!-- Botones de navegación -->
  <div class="navigation-buttons">
    <button class="btn-secondary" (click)="navigateBack()">Anterior</button>
    <button class="btn-primary" (click)="navigateNext()">Siguiente</button>
  </div>
</div>