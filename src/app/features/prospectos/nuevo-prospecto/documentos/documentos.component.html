<div class="documentos-container">
  <h2 class="section-title">Gestión de Documentos</h2>
  <p class="section-description">
    Carga, descarga y elimina documentos relacionados con el prospecto. Formatos permitidos: PDF, JPG, JPEG, PNG.
    (Máximo {{ MAX_DOCUMENTOS }} documentos)
  </p>

  <!-- Sección de carga de documentos -->
  <div class="upload-section">
    <div class="form-row">
      <div class="form-group">
        <label for="tipoDocumento">Tipo de Documento</label>
        <select
          id="tipoDocumento"
          [value]="tipoDocumentoSeleccionado"
          (change)="onTipoDocumentoChange($event)"
        >
          <option value="">Seleccionar...</option>
          @for (tipo of TIPOS_PERMITIDOS; track tipo.id) {
            <option [value]="tipo.id">{{ tipo.name }}</option>
          }
        </select>
      </div>

      <div class="form-group upload-file-group">
        <label for="archivo">Archivo</label>
        <div class="upload-control">
          <button class="file-select-button" (click)="fileInput.click()">
            <span class="icon-upload"></span> Cargar Documento
          </button>
          @if (archivoSeleccionado) {
            <span class="file-name">{{ archivoSeleccionado.name }}</span>
          }
          <input
            #fileInput
            type="file"
            id="archivo"
            class="file-input"
            (change)="onArchivoChange($event)"
            accept=".pdf,.jpg,.jpeg,.png"
          />
        </div>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group full-width">
        <label for="comentario">Comentario</label>
        <textarea
          id="comentario"
          rows="2"
          [(ngModel)]="comentario"
          placeholder="Agrega un comentario (opcional)"
        ></textarea>
      </div>
    </div>

    @if (mensajeError) {
      <div class="error-message">
        <span class="icon-warning"></span> {{ mensajeError }}
      </div>
    }

    <div class="upload-actions">
      <button
        class="btn-primary"
        (click)="agregarDocumento()"
        [disabled]="
          !archivoSeleccionado || !tipoDocumentoSeleccionado || documentos.length >= MAX_DOCUMENTOS || isUploadingDocument
        "
      >
        {{ isUploadingDocument ? 'Subiendo...' : 'Agregar' }}
      </button>
    </div>
  </div>

  <!-- Tabla de documentos -->
  <div class="documentos-table-container">
    <div class="table-header">
      <div class="column tipo-column">Tipo de Documento</div>
      <div class="column archivo-column">Archivo</div>
      <div class="column comentario-column">Comentario</div>
      <div class="column estado-column">Estado</div>
      <div class="column accion-column">Acciones</div>
    </div>
    @if (isLoading) {
      <div class="empty-state">
        <p>Cargando documentos...</p>
      </div>
    }
    @if (!isLoading && documentos.length === 0) {
      <div class="empty-state">
        <span class="icon-file empty-icon"></span>
        <p>No hay documentos cargados</p>
      </div>
    }

    <div class="table-body">
      @for (documento of documentos; track documento.id) {
        <div class="table-row">
          <div class="column tipo-column">{{ obtenerNombreTipoDocumento(documento.documentTypeId) }}</div>
          <div class="column archivo-column">
            <div class="file-info">
              <span [class]="'icon-file ' + obtenerClaseIconoArchivo(documento.mimeType)"></span>
              <div class="file-details">
                <span class="file-name">{{ documento.filename }}</span>
                <span class="file-size">{{ formatearTamanoArchivo(documento.sizeBytes) }}</span>
              </div>
            </div>
          </div>
          <div class="column comentario-column">{{ documento.comment || '-' }}</div>
          <div class="column estado-column">
            <span [class]="obtenerClaseIconoEstado(documento.reviewStatus)"></span>
            {{ obtenerTextoEstado(documento.reviewStatus) }}
          </div>
          <div class="column accion-column">
            <button
              class="btn-icon download-btn"
              (click)="descargarDocumento(documento)"
              title="Descargar"
            >
              <fa-icon [icon]="faDownload"></fa-icon>
            </button>
            <button
              class="btn-icon delete-btn"
              (click)="eliminarDocumento(documento.id)"
              title="Eliminar"
            >
              <fa-icon [icon]="faTrash"></fa-icon>
            </button>
          </div>
        </div>
      }
    </div>
  </div>

  <!-- Estado del Cliente y Botones de COMERCIAL -->
    @if (clientStatus) {
      <div class="client-status-section">
        <h3>Estado del Cliente: <span class="status-text">{{ getStatusDisplayText() }}</span></h3>
        
        <!-- Botones de RIESGOS  (Documentos completados) -->
        <div class="comercial-actions">
          <button
            class="btn-primary"
            (click)="marcarDocumentosCompletados()"
            [disabled]="!isDocumentosCompletadosEnabled() || isExecutingAction"
          >
            {{ isExecutingAction ? 'Procesando...' : 'Documentos Completados' }}
          </button>
          
        </div>

        <!-- Sección ADV -->
        <div class="adv-section">
          <h4>Acciones de ADV</h4>
          <div class="adv-actions">
            <button
              class="btn-primary"
              (click)="firmarContrato()"
              [disabled]="!isFirmaContratoEnabled() || isExecutingAction"
              [class.disabled]="!isFirmaContratoEnabled()"
            >
              {{ isExecutingAction ? 'Procesando...' : 'Firma de contrato' }}
            </button>
          </div>
          @if (!isFirmaContratoEnabled()) {
            <p class="status-requirement">Disponible solo cuando el estado sea "Aprobado por Riesgos"</p>
          }
        </div>
      </div>
    }

  <!-- Botones de navegación -->
  <div class="navigation-buttons">
    <button class="btn-secondary" (click)="navigateBack()">Anterior</button>
  </div>
</div>
